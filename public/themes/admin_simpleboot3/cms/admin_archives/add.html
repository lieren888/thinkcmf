<include file="public@header" />
<style type="text/css">
    .pic-list li {
        margin-bottom: 5px;
    }
</style>

<!-- <script type="text/html" id="photos-item-tpl">
    <li id="saved-image{id}">
        <input id="photo-{id}" type="hidden" name="photo_urls[]" value="{filepath}">
        <input class="form-control" id="photo-{id}-name" type="text" name="photo_names[]" value="{name}"
               style="width: 200px;" title="图片名称">
        <img id="photo-{id}-preview" src="{url}" style="height:36px;width: 36px;"
             onclick="imagePreviewDialog(this.src);">
        <a href="javascript:uploadOneImage('图片上传','#photo-{id}');">替换</a>
        <a href="javascript:(function(){$('#saved-image{id}').remove();})();">移除</a>
    </li>
</script>
<script type="text/html" id="files-item-tpl">
    <li id="saved-file{id}">
        <input id="file-{id}" type="hidden" name="file_urls[]" value="{filepath}">
        <input class="form-control" id="file-{id}-name" type="text" name="file_names[]" value="{name}"
               style="width: 200px;" title="文件名称">
        <a id="file-{id}-preview" href="{preview_url}" target="_blank">下载</a>
        <a href="javascript:uploadOne('文件上传','#file-{id}','file');">替换</a>
        <a href="javascript:(function(){$('#saved-file{id}').remove();})();">移除</a>
    </li>
</script> -->
</head>

<body>
    <div class="wrap js-check-wrap">
        <ul class="nav nav-tabs">
            <li><a href="{:url('AdminArchives/index')}">文章管理</a></li>
            <li class="active"><a href="{:url('AdminArchives/add')}">添加文章</a></li>
            <li><a href="{:url('AdminArchives/recyclebin')}">回收站</a></li>
        </ul>
        <form action="{:url('AdminArchives/addPost')}" method="post" class="form-horizontal js-ajax-form margin-top-20">
            <div class="row">
                <div class="col-md-9">
                    <table class="table table-bordered">
                        <tr>
                            <th width="100">分类<span class="form-required">*</span></th>
                            <td>
                                <select class="form-control" name="post[channel_id]" id="c-channel_id">
                                    {$category_tree|default=''}
                                </select>
                                <!-- <input class="form-control" type="text" style="width:400px;" required value=""
                                   placeholder="请选择分类" onclick="doSelectCategory();" id="js-categories-name-input"
                                   readonly/>
                            <input class="form-control" type="hidden" value="" name="post[channel_id]"
                                   id="js-categories-id-input"/> -->
                            </td>
                        </tr>
                        <tr>
                            <th>标题<span class="form-required">*</span></th>
                            <td>
                                <input class="form-control" type="text" name="post[title]" id="title" required value=""
                                    placeholder="请输入标题" />
                            </td>
                        </tr>
                        <tr>
                            <th>关键字</th>
                            <td>
                                <input class="form-control" type="text" name="post[keywords]" id="keywords" value=""
                                    placeholder="请输入关键字">
                                <p class="help-block">多关键词之间用英文逗号隔开</p>
                            </td>
                        </tr>
                        <!-- <tr>
                        <th>文章来源</th>
                        <td><input class="form-control" type="text" name="post[post_source]" id="source" value=""
                                   placeholder="请输入文章来源"></td>
                    </tr> -->
                        <tr>
                            <th>描述</th>
                            <td>
                                <textarea class="form-control" name="post[description]" style="height: 50px;"
                                    placeholder="请填写描述"></textarea>
                            </td>
                        </tr>
                        <tr>
                            <th>内容<span class="form-required">*</span></th>
                            <td>
                                <script type="text/plain" id="content" name="post[content]"></script>
                            </td>
                        </tr>

                        <!--
                        <tr>
                            <th>状态</th>
                            <td>
                                <input type="radio" name="status" value="1"> 显示
                                <input type="radio" name="status" value="0"> 隐藏
                            </td>
                        </tr>
                        <tr>
                            <th>日期时间</th>
                            <td>
                                <input class="form-control js-datetime" type="text" name="post[date]"
                                    value="">
                            </td>
                        </tr>
                        <tr>
                            <th>日期</th>
                            <td>
                                <input class="form-control js-date" type="text" name="post[date2]" value="">
                            </td>
                        </tr>
                        <tr>
                            <th>时间</th>
                            <td>
                                <input class="form-control js-bootstrap-datetime" type="text" name="post[date]"
                                    value="">
                            </td>
                        </tr>
                        <tr>
                            <th>日期</th>
                            <td>
                                <input class="form-control js-bootstrap-date" type="text" name="post[date2]" value="">
                            </td>
                        </tr>
                        <tr>
                            <th>封面</th>
                            <td>
                                <input type="hidden" name="post[fengmian]" id="fengmian" value="">
                                <a href="javascript:uploadOneImage('图片上传','#fengmian');">
                                    <img src="__TMPL__/public/assets/images/default-thumbnail.png" id="fengmian-preview"
                                        width="60" style="cursor: pointer" />
                                </a>
                                <input type="button" class="btn btn-sm btn-cancel-fengmian" value="取消图片">
                            </td>
                        </tr>
                        <tr>
                            <th>相册</th>
                            <td>
                                <ul id="photos" class="pic-list list-unstyled form-inline"></ul>
                                <a href="javascript:uploadMultiImage('图片上传','#photos','photos-item-tpl');"
                                    class="btn btn-default btn-sm">选择图片</a>
                            </td>
                        </tr>
                        <tr>
                            <th>附件</th>
                            <td>
                                <ul id="files" class="pic-list list-unstyled form-inline">
                                </ul>
                                <a href="javascript:uploadMultiFile('附件上传','#files','files-item-tpl','file');"
                                    class="btn btn-sm btn-default">选择文件</a>
                            </td>
                        </tr>
                        <tr>
                            <th>音频</th>
                            <td class="form-inline">
                                <input id="file-audio" class="form-control" type="text" name="post[more][audio]"
                                    value="{$post.more.audio|default=''}" placeholder="请上传音频文件" style="width: 200px;">
                                <notempty name="post.more.audio">
                                    <a id="file-audio-preview" href="{:cmf_get_file_download_url($post.more.audio)}"
                                        target="_blank">下载</a>
                                </notempty>

                                <a href="javascript:uploadOne('文件上传','#file-audio','audio');">上传</a>
                            </td>
                        </tr>
                        <tr>
                            <th>视频</th>
                            <td class="form-inline">
                                <input id="file-video" class="form-control" type="text" name="post[more][video]"
                                    value="{$post.more.video|default=''}" placeholder="请上传视频文件" style="width: 200px;">
                                <notempty name="post.more.video">
                                    <a id="file-video-preview" href="{:cmf_get_file_download_url($post.more.video)}"
                                        target="_blank">下载</a>
                                </notempty>
                                <a href="javascript:uploadOne('文件上传','#file-video','video');">上传</a>
                            </td>
                        </tr> 
                        -->
                    </table>
                    <div id="extend">
                        <table class="table table-bordered">
                        </table>
                    </div>
                    <div id="extend_upload">
                    </div>
                    <hook name="cms_admin_article_edit_view_main" />
                    <div class="form-group">
                        <div class="col-sm-offset-2 col-sm-10">
                            <button type="submit" class="btn btn-primary js-ajax-submit">{:lang('ADD')}</button>
                            <a class="btn btn-default" href="{:url('AdminArchives/index')}">{:lang('BACK')}</a>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <table class="table table-bordered">
                        <tr>
                            <th><b>缩略图</b></th>
                        </tr>
                        <tr>
                            <td>
                                <div style="text-align: center;">
                                    <input type="hidden" name="post[more][thumbnail]" id="thumbnail" value="">
                                    <a href="javascript:uploadOneImage('图片上传','#thumbnail');">
                                        <img src="__TMPL__/public/assets/images/default-thumbnail.png"
                                            id="thumbnail-preview" width="135" style="cursor: pointer" />
                                    </a>
                                    <input type="button" class="btn btn-sm btn-cancel-thumbnail" value="取消图片">
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <th><b>发布时间</b></th>
                        </tr>
                        <tr>
                            <td>
                                <input class="form-control js-bootstrap-datetime" type="text"
                                    name="post[published_time]" value="{:date('Y-m-d H:i:s',time())}">
                            </td>
                        </tr>
                    </table>
                    <hook name="cms_admin_archives_edit_view_right_sidebar" />
                </div>
            </div>
        </form>
    </div>
    <script type="text/javascript" src="__STATIC__/js/admin.js"></script>
    <script type="text/javascript">
        //编辑器路径定义
        var editorURL = GV.WEB_ROOT;
    </script>
    <script type="text/javascript" src="__STATIC__/js/ueditor/ueditor.config.js"></script>
    <script type="text/javascript" src="__STATIC__/js/ueditor/ueditor.all.min.js"></script>
    <script type="text/javascript">
        $(function () {

            editorcontent = new baidu.editor.ui.Editor();
            editorcontent.render('content');
            try {
                editorcontent.sync();
            } catch (err) {
            }

            $('.btn-cancel-thumbnail').click(function () {
                $('#thumbnail-preview').attr('src', '__TMPL__/public/assets/images/default-thumbnail.png');
                $('#thumbnail').val('');
            });

            //初始值
            init($('#c-channel_id').val());

            // //栏目选择
            // $(document).on('change', '#c-channel_id', function () {
            //     var model = $("option:selected", this).attr("model");
            //     $("#extend>table").html("<tr><td colspan='2' style='background:#000; color:#f00; text-align:center; padding:3px 0px;'>加载中...</td></tr>");
            //     $.ajax({
            //         type: 'post',
            //         url: 'get_channel_fields',
            //         data: { channel_id: $(this).val(), model_id: model },
            //         success: function (data) {
            //             //console.log(data);
            //             var array = eval(data);
            //             if (array.length > 0) {
            //                 //扩展说明
            //                 $("#extend>table").html("<tr><td colspan='2' style='background:#808270; color:#fff; text-align:center; padding:3px 0px;'>扩展字段</td></tr>");
            //                 for (i = 0; i < array.length; i++) {
            //                     //console.log(array[i]);
            //                     var html = '', uploadtxt = '';
            //                     var item = array[i];
            //                     switch (item.type.toLowerCase()) {
            //                         case "string"://文本
            //                             html += '<tr>';
            //                             html += '    <th>' + item.title + '<span class="form-required">*</span></th>';
            //                             html += '    <td>';
            //                             html += '        <input class="form-control" type="text" name="post[' + item.name + ']" id="' + item.name + '" required value="" placeholder="请输入' + item.title + '"/>';
            //                             html += '    </td>';
            //                             html += '</tr>';
            //                             break;
            //                         case "text"://文本框
            //                             html += '<tr>';
            //                             html += '    <th>' + item.title + '<span class="form-required">*</span></th>';
            //                             html += '    <td>';
            //                             html += '        <textarea class="form-control" name="post[' + item.name + ']" id="' + item.name + '" required style="height: 50px;" placeholder="请填写' + item.title + '"></textarea>';
            //                             html += '    </td>';
            //                             html += '</tr>';
            //                             break;
            //                         case "number"://数量
            //                             html += '<tr>';
            //                             html += '    <th>' + item.title + '<span class="form-required">*</span></th>';
            //                             html += '    <td>';
            //                             html += '        <input class="form-control" type="text" name="post[' + item.name + ']" id="' + item.name + '" required value="" placeholder="请输入' + item.title + '"/>';
            //                             html += '    </td>';
            //                             html += '</tr>';
            //                             break;
            //                         case "radio"://单选按钮
            //                             html += '<tr>';
            //                             html += '    <th>' + item.title + '<span class="form-required">*</span></th>';
            //                             html += '    <td>';
            //                             //可以用字符或字符串分割
            //                             if (item.content != '') {
            //                                 var content = $.trim(item.content).replace(new RegExp('\n', "gm"), ' ');//jquery实现textarea输入内容换行和空格
            //                                 var arr = content.split(' ');//例如：1|是 0|否
            //                                 //开始大遍历
            //                                 $.each(arr, function (index, j) {
            //                                     //开始小遍历
            //                                     var arr2 = $.trim(j).split('|');//例如：1|是
            //                                     $.each(arr2, function (index, k) {
            //                                         if (index == 0) {
            //                                             html += '<input type="radio" name="post[' + item.name + ']" value="' + k + '" />';
            //                                         } else {
            //                                             html += '&nbsp;' + k + '&nbsp;';
            //                                         }
            //                                     })
            //                                 })
            //                             }
            //                             html += '    </td>';
            //                             html += '</tr>';
            //                             break;
            //                         case "checkbox"://复选框按钮
            //                             html += '<tr>';
            //                             html += '    <th>' + item.title + '<span class="form-required">*</span></th>';
            //                             html += '    <td>';
            //                             //可以用字符或字符串分割
            //                             if (item.content != '') {
            //                                 var content = $.trim(item.content).replace(new RegExp('\n', "gm"), ' ');//jquery实现textarea输入内容换行和空格
            //                                 var arr = content.split(' ');//例如：1|是 0|否
            //                                 //开始大遍历
            //                                 $.each(arr, function (index, j) {
            //                                     //开始小遍历
            //                                     var arr2 = $.trim(j).split('|');//例如：1|是
            //                                     $.each(arr2, function (index, k) {
            //                                         if (index == 0) {
            //                                             html += '<input type="checkbox" name="post[' + item.name + ']" value="' + k + '" />';
            //                                         } else {
            //                                             html += '&nbsp;' + k + '&nbsp;';
            //                                         }
            //                                     })
            //                                 })
            //                             }
            //                             html += '    </td>';
            //                             html += '</tr>';
            //                             break;
            //                         case "date"://日期
            //                             html += '<tr>';
            //                             html += '    <th>' + item.title + '<span class="form-required">*</span></th>';
            //                             html += '    <td>';
            //                             html += '        <input class="form-control js-bootstrap-' + item.name + '" type="text" name="post[' + item.name + ']" value="" />';
            //                             html += '<script>';
            //                             html += '   $(function () {';
            //                             html += '       var bootstrapDateInput_' + item.name + ' = $("input.js-bootstrap-' + item.name + '");';
            //                             html += '       if (bootstrapDateInput_' + item.name + '.length) {';
            //                             html += '           Wind.css(\'bootstrapDatetimePicker\');';
            //                             html += '           Wind.use(\'bootstrapDatetimePicker\', function () {';
            //                             html += '               bootstrapDateInput_' + item.name + '.datetimepicker({';
            //                             html += '                   language: \'zh-CN\',';
            //                             html += '                   format: \'yyyy-mm-dd\',';
            //                             html += '                   minView: \'month\',';
            //                             html += '                   todayBtn: 1,';
            //                             html += '                   autoclose: true';
            //                             html += '               });';
            //                             html += '           });';
            //                             html += '       }';
            //                             html += '   })';
            //                             html += '<\/script>';
            //                             html += '    </td>';
            //                             html += '</tr>';
            //                             break;
            //                         case "time"://时间
            //                             html += '<tr>';
            //                             html += '    <th>' + item.title + '<span class="form-required">*</span></th>';
            //                             html += '    <td>';
            //                             html += '        <input class="form-control js-bootstrap-' + item.name + '" type="text" name="post[' + item.name + ']" value="" />';
            //                             html += '<script>';
            //                             html += '   $(function () {';
            //                             html += '       var bootstrapDateInput_' + item.name + ' = $("input.js-bootstrap-' + item.name + '");';
            //                             html += '       if (bootstrapDateInput_' + item.name + '.length) {';
            //                             html += '           Wind.css(\'bootstrapDatetimePicker\');';
            //                             html += '           Wind.use(\'bootstrapDatetimePicker\', function () {';
            //                             html += '               bootstrapDateInput_' + item.name + '.datetimepicker({';
            //                             html += '                   language: \'zh-CN\',';
            //                             html += '                   format: \'hh:ii\',';
            //                             html += '                   minView: \'month\',';
            //                             html += '                   todayBtn: 1,';
            //                             html += '                   autoclose: true';
            //                             html += '               });';
            //                             html += '           });';
            //                             html += '       }';
            //                             html += '   })';
            //                             html += '<\/script>';
            //                             html += '    </td>';
            //                             html += '</tr>';
            //                             break;
            //                         case "datetime"://日期时间
            //                             html += '<tr>';
            //                             html += '    <th>' + item.title + '<span class="form-required">*</span></th>';
            //                             html += '    <td>';
            //                             html += '        <input class="form-control js-bootstrap-' + item.name + '" type="text" name="post[' + item.name + ']" value="" />';
            //                             html += '<script>';
            //                             html += '   $(function () {';
            //                             html += '       var bootstrapDateInput_' + item.name + ' = $("input.js-bootstrap-' + item.name + '");';
            //                             html += '       if (bootstrapDateInput_' + item.name + '.length) {';
            //                             html += '           Wind.css(\'bootstrapDatetimePicker\');';
            //                             html += '           Wind.use(\'bootstrapDatetimePicker\', function () {';
            //                             html += '               bootstrapDateInput_' + item.name + '.datetimepicker({';
            //                             html += '                   language: \'zh-CN\',';
            //                             html += '                   format: \'yyyy-mm-dd hh:ii\',';
            //                             html += '                   todayBtn: 1,';
            //                             html += '                   autoclose: true';
            //                             html += '               });';
            //                             html += '           });';
            //                             html += '       }';
            //                             html += '   })';
            //                             html += '<\/script>';
            //                             html += '    </td>';
            //                             html += '</tr>';
            //                             break;
            //                         case "editor"://编辑器
            //                             html += '<tr>';
            //                             html += '    <th style="width:12%;">' + item.title + '<span class="form-required">*</span></th>';
            //                             html += '    <td>';
            //                             html += '        <script type="text/plain" id="' + item.name + '" name="post[' + item.name + ']"><\/script>';
            //                             html += '    </td>';
            //                             html += '<script>';
            //                             html += '   $(function () {'
            //                             html += '       editor_' + item.name + ' = new baidu.editor.ui.Editor();';
            //                             html += '       editor_' + item.name + '.render(\'' + item.name + '\');';
            //                             html += '       try {';
            //                             html += '           editor_' + item.name + '.sync();';
            //                             html += '       } catch (err) {';
            //                             html += '       }';
            //                             html += '   })';
            //                             html += '<\/script>';
            //                             html += '</tr>';
            //                             break;
            //                         case "image"://单图片
            //                             html += '<tr>';
            //                             html += '    <th>' + item.title + '</th>';
            //                             html += '    <td>';
            //                             html += '        <input type="hidden" name="post[' + item.name + ']" id="' + item.name + '" value="">';
            //                             html += '        <a href="javascript:uploadOneImage(\'图片上传\',\'#' + item.name + '\',\'\',\'cms\');">';
            //                             html += '            <img src="__TMPL__/public/assets/images/default-thumbnail.png" id="' + item.name + '-preview" width="60" style="cursor: pointer" />';
            //                             html += '        </a>';
            //                             html += '        <input type="button" class="btn btn-sm btn-cancel-' + item.name + '" value="取消图片">';
            //                             html += '    </td>';
            //                             html += '</tr>';
            //                             break;
            //                         case "images"://多图片(相册)
            //                             html += '<tr>';
            //                             html += '    <th>' + item.title + '</th>';
            //                             html += '    <td>';
            //                             html += '        <ul id="' + item.name + '" class="pic-list list-unstyled form-inline"></ul>';
            //                             html += '        <a href="javascript:uploadMultiImage(\'图片上传\',\'#' + item.name + '\',\'' + item.name + '-item-tpl\',\'\',\'cms\');" class="btn btn-default btn-sm">选择图片</a>';
            //                             html += '    </td>';
            //                             html += '</tr>';

            //                             uploadtxt += '<script type="text/html" id="' + item.name + '-item-tpl">';
            //                             uploadtxt += '    <li id="saved-image{id}">';
            //                             uploadtxt += '        <input id="photo-{id}" type="hidden" name="' + item.name + '_urls[]" value="{filepath}">';
            //                             uploadtxt += '        <input class="form-control" id="photo-{id}-name" type="text" name="' + item.name + '_names[]" value="{name}" style="width: 200px;" title="图片名称">';
            //                             uploadtxt += '        <img id="photo-{id}-preview" src="{url}" style="height:36px;width: 36px;" onclick="imagePreviewDialog(this.src);">';
            //                             uploadtxt += '        <a href="javascript:uploadOneImage(\'图片上传\',\'#photo-{id}\',\'\',\'cms\');">替换</a>';
            //                             uploadtxt += '        <a href="javascript:(function(){$(\'#saved-image{id}\').remove();})();">移除</a>';
            //                             uploadtxt += '    </li>';
            //                             uploadtxt += '<\/script>';
            //                             break;
            //                         case "file"://单文件
            //                             html += '<tr>';
            //                             html += '    <th>' + item.title + '</th>';
            //                             html += '    <td class="form-inline">';
            //                             html += '            <input id="file-' + item.name + '" class="form-control" type="text" name="post[' + item.name + ']" value="" placeholder="请上传文件" style="width: 200px;">';
            //                             html += '            <a href="javascript:uploadOne(\'文件上传\',\'#file-' + item.name + '\',\'file\',\'\',\'cms\');">上传</a>';
            //                             html += '    </td>';
            //                             html += '</tr>';
            //                             break;
            //                         case "files"://多文件
            //                             html += '<tr>';
            //                             html += '    <th>' + item.title + '</th>';
            //                             html += '    <td>';
            //                             html += '        <ul id="' + item.name + '" class="pic-list list-unstyled form-inline"></ul>';
            //                             html += '        <a href="javascript:uploadMultiFile(\'文件上传\',\'#' + item.name + '\',\'' + item.name + '-item-tpl\',\'file\',\'\',\'cms\');" class="btn btn-default btn-sm">选择文件</a>';
            //                             html += '    </td>';
            //                             html += '</tr>';

            //                             uploadtxt += '<script type="text/html" id="' + item.name + '-item-tpl">';
            //                             uploadtxt += '    <li id="saved-file{id}">';
            //                             uploadtxt += '        <input id="file-{id}" type="hidden" name="' + item.name + '_urls[]" value="{filepath}">';
            //                             uploadtxt += '        <input class="form-control" id="file-{id}-name" type="text" name="' + item.name + '_names[]" value="{name}" style="width: 200px;" title="文件名称">';
            //                             uploadtxt += '        <a id="file-{id}-preview" href="{preview_url}" target="_blank">下载</a>';
            //                             uploadtxt += '        <a href="javascript:uploadOne(\'文件上传\',\'#file-{id}\',\'file\',\'\',\'cms\');">替换</a>';
            //                             uploadtxt += '        <a href="javascript:(function(){$(\'#saved-file{id}\').remove();})();">移除</a>';
            //                             uploadtxt += '    </li>';
            //                             uploadtxt += '<\/script>';
            //                             break;
            //                         default:
            //                             break;
            //                     }
            //                     $("#extend>table").append(html);
            //                     $("#extend_upload").append(uploadtxt);
            //                 }
            //             } else {
            //                 $("#extend>table").html('');
            //             }
            //         }
            //     })
            // });
        });

        // function doSelectCategory() {
        //     var selectedCategoriesId = $('#js-categories-id-input').val();
        //     openIframeLayer("{:url('AdminChannel/select')}?ids=" + selectedCategoriesId, '请选择分类', {
        //         area: ['700px', '400px'],
        //         btn: ['确定', '取消'],
        //         yes: function (index, layero) {
        //             //do something

        //             var iframeWin = window[layero.find('iframe')[0]['name']];
        //             var selectedCategories = iframeWin.confirm();
        //             if (selectedCategories.selectedCategoriesId.length == 0) {
        //                 layer.msg('请选择分类');
        //                 return;
        //             }
        //             $('#js-categories-id-input').val(selectedCategories.selectedCategoriesId.join(','));
        //             $('#js-categories-name-input').val(selectedCategories.selectedCategoriesName.join(' '));
        //             //console.log(layer.getFrameIndex(index));
        //             layer.close(index); //如果设定了yes回调，需进行手工关闭
        //         }
        //     });
        // }
    </script>
    <script type="text/javascript" src="__TMPL__/cms/js/admin_archives_add.js?v=1.0.3"></script>
</body>

</html>